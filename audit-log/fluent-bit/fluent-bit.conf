[SERVICE]
    Flush        1
    Daemon       Off
    Log_Level    info
    Parsers_File parsers.conf

[INPUT]
    Name         tail
    Path         /var/log/compliance/*.log
    Tag          compliance.*
    DB           /var/log/flb_compliance.db
    Parser       json
    Mem_Buf_Limit 10MB
    Skip_Long_Lines On

[FILTER]
    Name         record_modifier
    Match        compliance.*
    Record       hostname ${HOSTNAME}

[FILTER]
    Name         lua
    Match        compliance.*
    script       sha_chain.lua
    call         chain_log_entry

[OUTPUT]
    Name         s3
    Match        compliance.*
    bucket       ${AUDIT_LOG_BUCKET}
    region       ${AWS_REGION}
    total_file_size 5M
    upload_timeout  5m
    s3_key_format audit-log/%Y/%m/%d/%H/%M/%S-${UUID}.log
    store_dir    /tmp/flb_s3
    use_put_object_lock true
    canned_acl   bucket-owner-full-control
    object_lock_mode COMPLIANCE
    object_lock_retain_days 2555
    tls         On
    tls.verify  On
